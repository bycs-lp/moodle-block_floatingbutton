{"version":3,"file":"iconpicker.min.js","sources":["../src/iconpicker.js"],"sourcesContent":["import { exception as displayException } from 'core/notification';\nimport Templates from 'core/templates';\nimport ICON_SET from 'block_floatingbutton/iconset';\n\nvar iconpickermodal;\n\nexport const init = (iconpickerdiv, iconpickerselector) => {\n    // Add index to icon set to make producing an unique id easier.\n    ICON_SET.forEach(function(v, i) {\n        v.index = i;\n    });\n\n    var clickSet = false;\n\n    // Make inputs of the moodle form invisible and add button for iconpicker.\n    let inputs = Array.from(document.querySelectorAll('.mbs-floatingicon-input input'));\n    inputs.forEach(function(input) {\n        input.setAttribute('style', 'visibility: collapse; width: 0; margin: 0; padding: 0; position: absolute;');\n        input.insertAdjacentHTML(\n            'afterend',\n            '<button class=\"mbs-floatingicons-iconpicker btn btn-secondary btn-icon\" type=\"button\" id=\"' + input.id +\n            '_button\" data-icon-input=\"' + input.id + '\"><i class=\"' + input.value + '\"></i></button>'\n        );\n    });\n\n    // Attach click listener to each iconpicker buton. The callback function also sets data-iconpicker\n    // and data-icon-input attributes.\n    let iconpickers = Array.from(document.querySelectorAll(iconpickerselector));\n    iconpickers.forEach(function(picker) {\n        picker.addEventListener('click', function() {\n            iconpickermodal.show();\n            document.querySelector('.mbs-iconpicker').setAttribute('data-iconpicker', picker.id);\n            document.querySelector('.mbs-iconpicker').setAttribute('data-icon-input', picker.getAttribute('data-icon-input'));\n            highlightselected();\n        });\n    });\n\n    // Build iconpicker modal with moodle modal factory\n    Templates.renderForPromise('block_floatingbutton/iconpicker', {icons: ICON_SET})\n        .then(({html}) => {\n            require(['jquery', 'core/modal_factory'], function($, ModalFactory) {\n                var trigger = $('#create-modal');\n                ModalFactory.create({\n                    title: 'Icon picker',\n                    body: html,\n                    footer: '',\n                }, trigger)\n                    .done(function (modal) {\n                        iconpickermodal = modal;\n                        modal.getRoot().on('modal:shown', function () {\n                            // Listeners for the icons and the search input have to be registered when modal is shown for the first\n                            // time because modal doesn't exist in the DOM before.\n                            if (!clickSet) {\n                                let search = document.querySelector('#mbs-iconpicker-search');\n                                search.addEventListener('input', function() {\n                                    let icons = Array.from(document.querySelectorAll('.mbs-iconpicker-icon'));\n                                    icons.forEach(function(icon) {\n                                        if(\n                                            icon.getAttribute('data-search').includes(search.value)\n                                        ) {\n                                            icon.setAttribute('style', '');\n                                        } else {\n                                            icon.setAttribute('style', 'display: none;');\n                                        }\n                                    });\n                                });\n                                let icons = Array.from(document.querySelectorAll('.mbs-iconpicker-icon'));\n                                icons.forEach(function (icon) {\n                                    icon.addEventListener('click', iconclick);\n                                });\n                                clickSet = true;\n                            }\n                        });\n                    });\n            });\n            return true;\n        }).catch(ex => displayException(ex));\n};\n\n/**\n * Adds class \"highlight\" to currently selected icon.\n */\nfunction highlightselected() {\n    let icons = Array.from(document.getElementsByClassName('mbs-iconpicker-icon'));\n    let input = document.querySelector('.mbs-iconpicker').getAttribute('data-icon-input');\n    if (!(input === null)) {\n        let iconclass = document.getElementById(input).getAttribute('value');\n        icons.forEach(function(icondiv) {\n            icondiv.classList.remove('highlight');\n            if (icondiv.querySelector('i').classList == iconclass) {\n                icondiv.classList.add('highlight');\n            }\n        });\n    }\n}\n\n/**\n * Function called when user clicks on an icon\n * @param {*} event\n */\nfunction iconclick(event) {\n    let id = document.querySelector('.mbs-iconpicker').getAttribute('data-iconpicker');\n    let input = document.querySelector('.mbs-iconpicker').getAttribute('data-icon-input');\n    if (id) {\n        let icondiv = event.target;\n        if (event.target.nodeName != 'DIV') {\n            icondiv = event.target.parentNode;\n        }\n        let iconclass = document.querySelector('#' + icondiv.id + ' i').classList;\n        document.getElementById(id).innerHTML = '<i class=\"' + iconclass + '\"></i>';\n        document.getElementById(input).setAttribute('value', iconclass);\n    }\n    highlightselected();\n    iconpickermodal.hide();\n}\n"],"names":["iconpickermodal","highlightselected","icons","Array","from","document","getElementsByClassName","input","querySelector","getAttribute","iconclass","getElementById","forEach","icondiv","classList","remove","add","iconclick","event","id","target","nodeName","parentNode","innerHTML","setAttribute","hide","iconpickerdiv","iconpickerselector","v","i","index","clickSet","querySelectorAll","insertAdjacentHTML","value","picker","addEventListener","show","renderForPromise","ICON_SET","then","_ref","html","require","$","ModalFactory","trigger","create","title","body","footer","done","modal","getRoot","on","search","icon","includes","catch","ex"],"mappings":"qQAIIA,8LA8EKC,wBACDC,MAAQC,MAAMC,KAAKC,SAASC,uBAAuB,wBACnDC,MAAQF,SAASG,cAAc,mBAAmBC,aAAa,sBACnD,OAAVF,MAAiB,KACfG,UAAYL,SAASM,eAAeJ,OAAOE,aAAa,SAC5DP,MAAMU,SAAQ,SAASC,SACnBA,QAAQC,UAAUC,OAAO,aACrBF,QAAQL,cAAc,KAAKM,WAAaJ,WACxCG,QAAQC,UAAUE,IAAI,0BAU7BC,UAAUC,WACXC,GAAKd,SAASG,cAAc,mBAAmBC,aAAa,mBAC5DF,MAAQF,SAASG,cAAc,mBAAmBC,aAAa,sBAC/DU,GAAI,KACAN,QAAUK,MAAME,OACS,OAAzBF,MAAME,OAAOC,WACbR,QAAUK,MAAME,OAAOE,gBAEvBZ,UAAYL,SAASG,cAAc,IAAMK,QAAQM,GAAK,MAAML,UAChET,SAASM,eAAeQ,IAAII,UAAY,aAAeb,UAAY,SACnEL,SAASM,eAAeJ,OAAOiB,aAAa,QAASd,WAEzDT,oBACAD,gBAAgByB,qBA3GA,CAACC,cAAeC,uCAEvBf,SAAQ,SAASgB,EAAGC,GACzBD,EAAEE,MAAQD,SAGVE,UAAW,EAGF5B,MAAMC,KAAKC,SAAS2B,iBAAiB,kCAC3CpB,SAAQ,SAASL,OACpBA,MAAMiB,aAAa,QAAS,8EAC5BjB,MAAM0B,mBACF,WACA,6FAA+F1B,MAAMY,GACrG,6BAA+BZ,MAAMY,GAAK,eAAiBZ,MAAM2B,MAAQ,sBAM/D/B,MAAMC,KAAKC,SAAS2B,iBAAiBL,qBAC3Cf,SAAQ,SAASuB,QACzBA,OAAOC,iBAAiB,SAAS,WAC7BpC,gBAAgBqC,OAChBhC,SAASG,cAAc,mBAAmBgB,aAAa,kBAAmBW,OAAOhB,IACjFd,SAASG,cAAc,mBAAmBgB,aAAa,kBAAmBW,OAAO1B,aAAa,oBAC9FR,6CAKEqC,iBAAiB,kCAAmC,CAACpC,MAAOqC,mBACjEC,MAAKC,WAACC,KAACA,kBACJC,QAAQ,CAAC,SAAU,uBAAuB,SAASC,EAAGC,kBAC9CC,QAAUF,EAAE,iBAChBC,aAAaE,OAAO,CAChBC,MAAO,cACPC,KAAMP,KACNQ,OAAQ,IACTJ,SACEK,MAAK,SAAUC,OACZpD,gBAAkBoD,MAClBA,MAAMC,UAAUC,GAAG,eAAe,eAGzBvB,SAAU,KACPwB,OAASlD,SAASG,cAAc,0BACpC+C,OAAOnB,iBAAiB,SAAS,WACjBjC,MAAMC,KAAKC,SAAS2B,iBAAiB,yBAC3CpB,SAAQ,SAAS4C,MAEfA,KAAK/C,aAAa,eAAegD,SAASF,OAAOrB,OAEjDsB,KAAKhC,aAAa,QAAS,IAE3BgC,KAAKhC,aAAa,QAAS,wBAI3BrB,MAAMC,KAAKC,SAAS2B,iBAAiB,yBAC3CpB,SAAQ,SAAU4C,MACpBA,KAAKpB,iBAAiB,QAASnB,cAEnCc,UAAW,aAKxB,KACR2B,OAAMC,KAAM,2BAAiBA"}