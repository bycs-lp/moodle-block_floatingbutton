{"version":3,"file":"iconpicker.min.js","sources":["../src/iconpicker.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nimport Modal from 'core/modal';\nimport ICON_SET from 'block_floatingbutton/iconset';\n\nconst SELECTORS = {\n  iconpicker: \".block_floatingbutton-iconpicker\",\n  iconpicker_input: \".block_floatingbutton-input input\",\n  iconpicker_search_input: \".block_floatingbutton-iconpicker-search-input\",\n  iconpicker_icon: \".block_floatingbutton-iconpicker-icon\",\n};\n\nexport const init = (iconpickerclass) => {\n    // Add index to icon set to make producing an unique id easier.\n    ICON_SET.forEach(function(v, i) {\n        v.index = i;\n    });\n\n    // Make inputs of the moodle form invisible and add button for iconpicker.\n    let inputs = Array.from(document.querySelectorAll(SELECTORS.iconpicker_input));\n    inputs.forEach(function(input) {\n        input.setAttribute('style', 'visibility: collapse; width: 0; margin: 0; padding: 0; position: absolute;');\n        input.insertAdjacentHTML(\n            'afterend',\n            '<button class=\"' + iconpickerclass + ' btn btn-secondary btn-icon\" type=\"button\" id=\"' + input.name +\n            '_button\" data-iconpicker-input=\"' + input.name + '\"><i class=\"' + input.value + '\"></i></button>'\n        );\n    });\n\n    // Attach click listener to each iconpicker buton. The callback function also sets data-iconpicker\n    // and data-iconpicker-input attributes.\n    let iconpickers = Array.from(document.querySelectorAll(\".\" + iconpickerclass));\n    iconpickers.forEach(function(picker) {\n        picker.addEventListener('click', function(event) {\n            let target = event.target.closest('.' + iconpickerclass);\n            buildModal(target.id, target.getAttribute('data-iconpicker-input'));\n        });\n    });\n};\n\n/**\n * Build modal for iconpicker.\n * @param {*} target\n * @param {*} input\n */\nconst buildModal = async(target, input) => {\n    try {\n        const {html} = await Templates.renderForPromise('block_floatingbutton/iconpicker', {\n            target: target,\n            input: input,\n            icons: ICON_SET\n        });\n\n        const modal = await Modal.create({\n            title: 'Icon picker',\n            body: html,\n            footer: '',\n        });\n\n        modal.getRoot().on('modal:shown', function(event) {\n            const iconpicker = event.target.querySelector(SELECTORS.iconpicker);\n            // Listeners for the icons and the search input have to be registered when modal is shown for the first\n            // time because modal doesn't exist in the DOM before.\n            const search = iconpicker.querySelector(SELECTORS.iconpicker_search_input);\n            search.addEventListener('input', searchicon);\n            const icons = Array.from(iconpicker.querySelectorAll(SELECTORS.iconpicker_icon));\n            icons.forEach(function(icon) {\n                icon.addEventListener('click', (e) => {\n                    iconclick(e);\n                    modal.hide();\n                });\n            });\n        });\n\n        modal.show();\n        highlightselected();\n    } catch (ex) {\n        displayException(ex);\n    }\n};\n\n/**\n * Show only icons that match the search value.\n * @param {*} event\n */\nfunction searchicon(event) {\n    let modal = event.target.closest(SELECTORS.iconpicker);\n    let search = event.target.closest(SELECTORS.iconpicker_search_input);\n    let icons = Array.from(modal.querySelectorAll(SELECTORS.iconpicker_icon));\n    icons.forEach(function(icon) {\n        if (\n            icon.getAttribute('data-search').includes(search.value)\n        ) {\n            icon.setAttribute('style', '');\n        } else {\n            icon.setAttribute('style', 'display: none;');\n        }\n    });\n}\n\n/**\n * Adds class \"highlight\" to currently selected icon.\n */\nfunction highlightselected() {\n    let icons = Array.from(document.getElementsByClassName(SELECTORS.iconpicker_icon));\n    let input = document.querySelector(SELECTORS.iconpicker).getAttribute('data-iconpicker-input');\n    if (!(input === null)) {\n        let iconclass = document.querySelector(`[name=\"${input}\"]`).getAttribute('value');\n        icons.forEach(function(icondiv) {\n            icondiv.classList.remove('highlight');\n            if (icondiv.querySelector('i').classList == iconclass) {\n                icondiv.classList.add('highlight');\n            }\n        });\n    }\n}\n\n/**\n * Function called when user clicks on an icon\n * @param {*} event\n */\nfunction iconclick(event) {\n    let modal = event.target.closest(SELECTORS.iconpicker);\n    let target = modal.getAttribute('data-iconpicker');\n    let input = modal.getAttribute('data-iconpicker-input');\n    if (target) {\n        let icondiv = event.target.closest(SELECTORS.iconpicker_icon);\n        let iconclass = document.querySelector('#' + icondiv.id + ' i').classList;\n        document.getElementById(target).innerHTML = '<i class=\"' + iconclass + '\"></i>';\n        document.querySelector(`[name=\"${input}\"]`).setAttribute('value', iconclass);\n    }\n    highlightselected(modal);\n}\n"],"names":["SELECTORS","iconpickerclass","forEach","v","i","index","Array","from","document","querySelectorAll","input","setAttribute","insertAdjacentHTML","name","value","picker","addEventListener","event","target","closest","buildModal","id","getAttribute","async","html","Templates","renderForPromise","icons","ICON_SET","modal","Modal","create","title","body","footer","getRoot","on","iconpicker","querySelector","searchicon","icon","e","icondiv","iconclass","classList","getElementById","innerHTML","highlightselected","iconclick","hide","show","ex","search","includes","getElementsByClassName","remove","add"],"mappings":"seAKMA,qBACQ,mCADRA,2BAEc,oCAFdA,kCAGqB,gDAHrBA,0BAIa,sDAGEC,mCAERC,SAAQ,SAASC,EAAGC,GACzBD,EAAEE,MAAQD,KAIDE,MAAMC,KAAKC,SAASC,iBAAiBT,6BAC3CE,SAAQ,SAASQ,OACpBA,MAAMC,aAAa,QAAS,8EAC5BD,MAAME,mBACF,WACA,kBAAoBX,gBAAkB,kDAAoDS,MAAMG,KAChG,mCAAqCH,MAAMG,KAAO,eAAiBH,MAAMI,MAAQ,sBAMvER,MAAMC,KAAKC,SAASC,iBAAiB,IAAMR,kBACjDC,SAAQ,SAASa,QACzBA,OAAOC,iBAAiB,SAAS,SAASC,WAClCC,OAASD,MAAMC,OAAOC,QAAQ,IAAMlB,iBACxCmB,WAAWF,OAAOG,GAAIH,OAAOI,aAAa,uCAUhDF,WAAaG,MAAML,OAAQR,mBAEnBc,KAACA,YAAcC,mBAAUC,iBAAiB,kCAAmC,CAC/ER,OAAQA,OACRR,MAAOA,MACPiB,MAAOC,mBAGLC,YAAcC,eAAMC,OAAO,CAC7BC,MAAO,cACPC,KAAMT,KACNU,OAAQ,KAGZL,MAAMM,UAAUC,GAAG,eAAe,SAASnB,aACjCoB,WAAapB,MAAMC,OAAOoB,cAActC,sBAG/BqC,WAAWC,cAActC,mCACjCgB,iBAAiB,QAASuB,YACnBjC,MAAMC,KAAK8B,WAAW5B,iBAAiBT,4BAC/CE,SAAQ,SAASsC,MACnBA,KAAKxB,iBAAiB,SAAUyB,cAsD7BxB,WACXY,MAAQZ,MAAMC,OAAOC,QAAQnB,sBAC7BkB,OAASW,MAAMP,aAAa,mBAC5BZ,MAAQmB,MAAMP,aAAa,4BAC3BJ,OAAQ,KACJwB,QAAUzB,MAAMC,OAAOC,QAAQnB,2BAC/B2C,UAAYnC,SAAS8B,cAAc,IAAMI,QAAQrB,GAAK,MAAMuB,UAChEpC,SAASqC,eAAe3B,QAAQ4B,UAAY,aAAeH,UAAY,SACvEnC,SAAS8B,+BAAwB5B,aAAWC,aAAa,QAASgC,WAEtEI,oBA/DgBC,CAAUP,GACVZ,MAAMoB,gBAKlBpB,MAAMqB,OACNH,oBACF,MAAOI,gCACYA,eAQhBZ,WAAWtB,WACZY,MAAQZ,MAAMC,OAAOC,QAAQnB,sBAC7BoD,OAASnC,MAAMC,OAAOC,QAAQnB,mCACtBM,MAAMC,KAAKsB,MAAMpB,iBAAiBT,4BACxCE,SAAQ,SAASsC,MAEfA,KAAKlB,aAAa,eAAe+B,SAASD,OAAOtC,OAEjD0B,KAAK7B,aAAa,QAAS,IAE3B6B,KAAK7B,aAAa,QAAS,8BAQ9BoC,wBACDpB,MAAQrB,MAAMC,KAAKC,SAAS8C,uBAAuBtD,4BACnDU,MAAQF,SAAS8B,cAActC,sBAAsBsB,aAAa,4BACtD,OAAVZ,MAAiB,KACfiC,UAAYnC,SAAS8B,+BAAwB5B,aAAWY,aAAa,SACzEK,MAAMzB,SAAQ,SAASwC,SACnBA,QAAQE,UAAUW,OAAO,aACrBb,QAAQJ,cAAc,KAAKM,WAAaD,WACxCD,QAAQE,UAAUY,IAAI"}